<div class="dashboard-container"> <!-- 1 -->

  <div id="user-cal-container" class="full-padded" style="border: solid blue 2px;"> <!-- 3 -->
    <div id="user-container">
      <% if @user.photo.file.nil? %>
        <div class="empty-picture-small"">
          <p>-- No picture --</p>
        </div>
      <% else %>
        <!-- <div class="user-photo text-center"> -->
          <%= cl_image_tag @user.photo, height: 100, width: 75, crop: :fill %>
        <!-- </div> -->
      <% end %>
      <h2><%= "Hi #{@user.first_name}!" %></h2>
    </div>
    <div id='cal-container'>
      <div class="simple-calendar">
        <%= month_calendar(attribute: :show_date, events: @pairings) do |date, pairings| %>

          <%= date.day %>

          <% pairings.each do |pairing| %>
            <% case pairing.status %>
              <% when "pending" %>
                <!-- <div style="position: relative;"> -->
                  <i class="fas fa-square" style="color: orange; position: relative;bottom: 0; right: 0;"></i>
                <!-- </div> -->
              <% when "accepted" %>
                <i class="fas fa-square" style="color: green; position: relative;bottom: 0; right: 0;"></i>
              <% when "declined" %>
                <i class="fas fa-square" style="color: gray; position: relative;bottom: 0; right: 0;"></i>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div> <!-- 3 -->
  <!-- <div class="main-container full-padded" style="border: solid white 2px;"> --> <!-- 2 -->
  <div class="show-container" style="flex: 1 0 auto; border: solid orange 2px;"> <!-- 4 -->
    <div class="pairings" style="border: solid green 2px;">
      <h1>Confirmed CineFriends</h1>
      <% @pairings.each do |pairing| %>
        <% posting =  pairing.posting %>
        <% show =  posting.show %>
        <% current_user_is_poster = (posting.user == @user) %>
        <% other_user = current_user_is_poster ? pairing.user : posting.user %>
        <div class="posting" style="padding: 15px; margin: 15px; position: relative; background-color: #e0e0e0;border-radius: 15px;border: solid red 2px;">
          <div class="movie-friend-container" style="display: flex; justify-content: space-around; margin-bottom: 5px;">
            <div class="movie-container" style="width: 250px; text-align: center; border: solid red 2px;" >
              <%# link_to posting_path(posting) do %>
                <h4 style="font-family: $body-font !important"><%= show.movie.title %></h4>
                <div class="thumb-wrapper">
                  <% if show.movie.poster.nil? %>
                    <div class="empty-thumbnail">
                      <p>-- No picture --</p>
                    </div>
                  <% else %>
                    <%= cl_image_tag show.movie.poster, height: 300, width: 200 %>
                  <% end %>
                </div>
              <%# end %>
            </div>

            <div class="friend-container" style="text-align: center">
              <div class="card-wrapper">
                <div class="carduser">
                  <div class="cardimageuser", style="background-image: url(<%= other_user.photo.url %>);">
                  </div>
                    <div class="card-info1user">
                      <%= other_user.first_name %>
                    </div>
                    <div class="card-info2user">
                      <span class="glyphicon glyphicon-calendar "></span>  <%= Date.today.year == posting.show.date.year ? posting.show.date.strftime("%-d %B") : posting.show.date.strftime("%-d %B %Y")%> <span class="glyphicon glyphicon-time "></span>   <%= posting.show.time.strftime("%-H:%M") %>
                    </div>
                    <div class="card-info3user">
                      <%= posting.show.theater.name %>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <% if current_user_is_poster %>
            <% case pairing.status #"#"%>
              <% when "pending" %>
                <div class="div-pairing-status pending">
                  <div>
                    <%= pairing.status.capitalize%>
                  </div>
                  <div style="margin: 10px;">
                    <%= link_to "Accept", "#", class: "btn-sm btn-success" %>
                    <%= link_to "Decline", "#", class: "btn-sm btn-danger" %>
                  </div>
                </div>
              <% when "accepted" %>
                <div class="div-pairing-status accepted">
                  <div>
                    <%= pairing.status.capitalize%>
                  </div>
                  <div style="margin: 10px;">
                    <%= link_to "Cancel", "#", class: "btn-sm btn-danger" %>
                  </div>
                </div>
              <% when "declined" %>
                <div class="div-pairing-status declined">
                  <div>
                    <%= pairing.status.capitalize%>
                  </div>
                  <div style="margin: 10px;">
                    <%= link_to "Accept", "#", class: "btn-sm btn-success" %>
                  </div>
                </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="unmatched-postings" style="border: solid red 2px;">
      <h1>Your postings</h1>
      <% @unmatched_postings.each do |posting| %>
          <% show = posting.show  %>
          <div class="posting" style="display: flex; justify-content: space-around; padding: 15px; margin: 15px; position: relative; background-color: #e0e0e0;border-radius: 15px;border: solid red 2px;">
            <div style="width: 250px; text-align: center; border: solid red 2px;" >
              <%# link_to posting_path(posting) do %>
                <h4 style="font-family: $body-font !important"><%= show.movie.title %></h4>
                <div class="thumb-wrapper">
                  <% if show.movie.poster.nil? %>
                    <div class="empty-thumbnail">
                      <p>-- No picture --</p>
                    </div>
                  <% else %>
                    <%= cl_image_tag show.movie.poster, height: 200, width: 133 %>
                  <% end %>
                </div>
              <%# end %>
              <div style="margin: 10px;">
                <%= link_to "Edit posting", "#", class: "btn-sm" %>
                <%= link_to "Remove posting", posting_path(posting), class: "btn-sm btn-danger", method: :delete %>
              </div>
            </div>
      </div>
          <% end %>
    </div> <!-- 4 -->
  </div>  <!-- 2 -->
</div>  <!-- 1 -->
